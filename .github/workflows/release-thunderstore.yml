name: Update Thunderstore page
on:
    release:
        types: [published, edited]
jobs:
    publish:
        runs-on: ubuntu-latest
        steps:
        - name: Checkout
          uses: actions/checkout@v4
          with:
            ref: ${{ github.event.release.tag_name }}
            fetch-depth: 0
            filter: tree:0

        - name: Parse version number
          id: patch_number
          run: |
            patch_number=$((${{ github.run_number }} + 9))
            echo "patch_number=$patch_number" >> $GITHUB_OUTPUT

        - uses: dhkatz/thunderstore-publish@v1.0.1
          id: publish
          with:
            token: ${{ secrets.TS_TOKEN }}
            namespace: CementGB
            name: CementGB
            description: A general-purpose modding API for Gang Beasts.
            version: 4.0.${{ steps.patch_number.outputs.* }} # Offset by number of pre-existing preview versions.
            communities: gang-beasts
            categories: mods
 
        - name: Output URL
          run: echo "Published Thunderstore package to ${{ steps.publish.outputs.url }}"
